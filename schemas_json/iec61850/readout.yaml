$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "hat-drivers://iec61850/readout.yaml"
type: object
required:
    - devices
properties:
    type:
        const: iec61850-readout
    version:
        const: '1'
    devices:
        type: array
        items:
            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/device"
$defs:
    device:
        type: object
        required:
            - connection
            - value_types
            - datasets
            - rcbs
            - data
            - commands
        properties:
            ied_name:
                type: string
            connection:
                type: object
                properties:
                    host:
                        type: string
                    port:
                        type: integer
                    tsel:
                        type: integer
                    ssel:
                        type: integer
                    psel:
                        type: integer
                    ap_title:
                        type: array
                        items:
                            type: integer
                    ae_qualifier:
                        type: integer
            value_types:
                type: array
                items:
                    type: object
                    required:
                        - logical_device
                        - logical_node
                        - fc
                        - name
                        - type
                    properties:
                        logical_device:
                            type: string
                        logical_node:
                            type: string
                        fc:
                            type: string
                        name:
                            type: string
                        type:
                            oneOf:
                              - $ref: "hat-drivers://iec61850/readout.yaml#/$defs/value_type"
                              - type: 'null'
            datasets:
                type: array
                items:
                    type: object
                    required:
                        - ref
                        - values
                    properties:
                        ref:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/dataset"
                        values:
                            type: array
                            items:
                                $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/data"
            rcbs:
                type: array
                items:
                    type: object
                    required:
                        - ref
                        - report_id
                        - dataset
                        - conf_revision
                        - optional_fields
                        - buffer_time
                        - trigger_options
                        - integrity_period
                    properties:
                        ref:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/rcb"
                        report_id:
                            type: string
                        dataset:
                            oneOf:
                                - type: 'null'
                                - $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/dataset"
                        conf_revision:
                            type: integer
                        optional_fields:
                            type: array
                            items:
                                enum:
                                    - SEQUENCE_NUMBER
                                    - REPORT_TIME_STAMP
                                    - REASON_FOR_INCLUSION
                                    - DATA_SET_NAME
                                    - DATA_REFERENCE
                                    - BUFFER_OVERFLOW
                                    - ENTRY_ID
                                    - CONF_REVISION
                        buffer_time:
                            type: integer
                        trigger_options:
                            type: array
                            items:
                                enum:
                                    - DATA_CHANGE
                                    - QUALITY_CHANGE
                                    - DATA_UPDATE
                                    - INTEGRITY
                                    - GENERAL_INTERROGATION
                        integrity_period:
                            type: integer
            data:
                type: array
                items:
                    type: object
                    required:
                        - value
                        - value_type
                        - datasets
                        - writable
                    properties:
                        value:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/data"
                        value_type:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/value_type"
                        quality:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/data"
                        timestamp:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/data"
                        selected:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/data"
                        datasets:
                            type: array
                            items:
                                type: object
                                required:
                                    - ref
                                    - quality
                                    - timestamp
                                    - selected
                                properties:
                                    ref:
                                        $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/dataset"
                                    quality:
                                        type: boolean
                                    timestamp:
                                        type: boolean
                                    selected:
                                        type: boolean
                        writable:
                            type: boolean
                        enumerated:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/enumerated"
            commands:
                type: array
                items:
                    type: object
                    required:
                        - ref
                        - value_type
                        - model
                        - with_operate_time
                    properties:
                        ref:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/refs/command"
                        value_type:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/value_type"
                        model:
                            enum:
                                - DIRECT_WITH_NORMAL_SECURITY
                                - SBO_WITH_NORMAL_SECURITY
                                - DIRECT_WITH_ENHANCED_SECURITY
                                - SBO_WITH_ENHANCED_SECURITY
                        with_operate_time:
                            type: boolean
                        enumerated:
                            $ref: "hat-drivers://iec61850/readout.yaml#/$defs/enumerated"
            dynamic:
                type: object
                properties:
                    rcb_editable:
                        type: object
                        properties:
                            report_id:
                                type: boolean
                            dataset:
                                type: boolean
                            optional_fields:
                                type: boolean
                            buffer_time:
                                type: boolean
                            trigger_options:
                                type: boolean
                            integrity_period:
                                type: boolean
                    max_datasets:
                        type: integer
                    max_dataset_attributes:
                        type: integer
    refs:
        data:
            type: object
            required:
                - logical_device
                - logical_node
                - fc
                - names
            properties:
                logical_device:
                    type: string
                logical_node:
                    type: string
                fc:
                    type: string
                names:
                    type: array
                    items:
                        type:
                            - string
                            - integer
        command:
            type: object
            required:
                - logical_device
                - logical_node
                - name
            properties:
                logical_device:
                    type: string
                logical_node:
                    type: string
                name:
                    type: string
        rcb:
            type: object
            required:
                - logical_device
                - logical_node
                - type
                - name
            properties:
                logical_device:
                    type: string
                logical_node:
                    type: string
                type:
                    enum:
                        - BUFFERED
                        - UNBUFFERED
                name:
                    type: string
        dataset:
            type: object
            required:
                - logical_device
                - logical_node
                - name
            properties:
                logical_device:
                    type: string
                logical_node:
                    type: string
                name:
                    type: string
    value_type:
        oneOf:
          - enum:
                - BOOLEAN
                - INTEGER
                - UNSIGNED
                - FLOAT
                - BIT_STRING
                - OCTET_STRING
                - VISIBLE_STRING
                - MMS_STRING
                - QUALITY
                - TIMESTAMP
                - DOUBLE_POINT
                - DIRECTION
                - SEVERITY
                - ANALOGUE
                - VECTOR
                - STEP_POSITION
                - BINARY_CONTROL
          - type: object
            required:
                - type
                - element_type
                - length
            properties:
                type:
                    const: ARRAY
                element_type:
                    $ref: "hat-drivers://iec61850/readout.yaml#/$defs/value_type"
                length:
                    type: integer
          - type: object
            required:
                - type
                - elements
            properties:
                type:
                    const: STRUCT
                elements:
                    type: array
                    items:
                        type: object
                        requried:
                            - name
                            - type
                        properties:
                            name:
                                type: string
                            type:
                                $ref: "hat-drivers://iec61850/readout.yaml#/$defs/value_type"
    enumerated:
        required:
            - name
            - values
        properties:
            name:
                type: string
            values:
                type: array
                items:
                    type: object
                    required:
                        - value
                        - label
                    properties:
                        value:
                            type: integer
                        label:
                            type: string
